// --------------------------------------------------------
// Code generated by Papyrus C++
// --------------------------------------------------------

#ifndef LEGOCARFACTORYREFACTORINGFORSYNC___ARCHITECTURE__DELEGATEE_BACK_BACKCONTROLCOMPONENT__DELEGATEE_H
#define LEGOCARFACTORYREFACTORINGFORSYNC___ARCHITECTURE__DELEGATEE_BACK_BACKCONTROLCOMPONENT__DELEGATEE_H

/************************************************************
 BackControlComponent__Delegatee class header
 ************************************************************/

#include "LegoCarFactoryRefactoringForSync/__Architecture__Delegatee/Back/Pkg_Back.h"

#include "AnsiCLibrary/Pkg_AnsiCLibrary.h"
#include "pthread.h"
#include "statemachine/EventQueueAllocationConfiguration.h"
#include "statemachine/Pkg_statemachine.h"
#include "statemachine/StructForThread_t.h"

// Include from Include stereotype (header)
#define BACKCONTROLCOMPONENT__DELEGATEE_TIME_EVENT_LOWER_BOUND (0)
#define BACKCONTROLCOMPONENT__DELEGATEE_CHANGE_EVENT_LOWER_BOUND (1)
#define BACKCONTROLCOMPONENT__DELEGATEE_TE_INDEX(id) (id - BACKCONTROLCOMPONENT__DELEGATEE_TIME_EVENT_LOWER_BOUND)
#define BACKCONTROLCOMPONENT__DELEGATEE_CHE_INDEX(id) (id - BACKCONTROLCOMPONENT__DELEGATEE_CHANGE_EVENT_LOWER_BOUND)
#define BACKCONTROLCOMPONENT_BACKCONTROLSTATEMACHINE_REGION1_DEFAULT (0)
#define BACKCONTROLCOMPONENT_PRINCIPALSTATE_REGION1_DEFAULT (0)
#define BACKCONTROLCOMPONENT_EMNERGENCYSTOPSTATE_REGION1_DEFAULT (0)
#define BACKCONTROLCOMPONENT_EMNERGENCYSTOPSTATE_REGION1_CHECK (1)
#define BACKCONTROLCOMPONENT_PRINCIPALSTATE_REGION2_DEFAULT (0)
#define BACKCONTROLCOMPONENT_REGION_ID_PRINCIPALSTATE_REGION1 (0)
#define BACKCONTROLCOMPONENT_REGION_ID_PRINCIPALSTATE_REGION2 (1)
#define BACKCONTROLCOMPONENT_BACKCONTROLSTATEMACHINE_REGION1 (0)
#define BACKCONTROLCOMPONENT_PRINCIPALSTATE_REGION1 (1)
#define BACKCONTROLCOMPONENT_EMNERGENCYSTOPSTATE_REGION1 (2)
#define BACKCONTROLCOMPONENT_PRINCIPALSTATE_REGION2 (3)
#include "time.h"
#include "pthread.h"
#include "time.h"
#include "sys/time.h"
//the termination of doActivity is implemented in terms of check points that the developers write
//fine-grained code to explicitly use check points to exit doActivity
#ifdef CHECKPOINT 
#undef CHECKPOINT
#endif
#define CHECKPOINT if (backcontrolcomponentController.systemState == statemachine::EVENT_PROCESSING || backcontrolcomponentController.systemState == statemachine::STOPPED) {return;}
#define BackControlComponent__Delegatee_THREAD_CREATE(thThread, str) pthread_create(&thThread, NULL, &BackControlComponent__Delegatee::thread_func_wrapper, &str);
#define BACKCONTROLCOMPONENT__DELEGATEE_GET_CONTROL /*mutex synchronization to protect run-to-completion semantics*/ \
		while (!dispatchFlag) {} \
		pthread_mutex_lock(&runToCompletionMutex); \
		while (systemState != statemachine::IDLE || eventQueue.getCompletionSize() > 0) {\
			pthread_cond_wait(&runToCompletionCond, &runToCompletionMutex);\
		}
#define BACKCONTROLCOMPONENT__DELEGATEE_RELEASE_CONTROL systemState = statemachine::IDLE; pthread_cond_signal(&runToCompletionCond); \
				pthread_mutex_unlock(&runToCompletionMutex);
namespace CarFactoryLibrary {
namespace events {
class ErrorDetection;
}
}
namespace CarFactoryLibrary {
namespace events {
class EndOfModule;
}
}
namespace LegoCarFactoryRefactoringForSync {
namespace signals {
class StopProcess;
}
}
namespace LegoCarFactoryRefactoringForSync {
namespace signals {
class RestartAfterEmergencyStop;
}
}
namespace LegoCarFactoryRefactoringForSync {
namespace signals {
class PrepareConveyor;
}
}
namespace CarFactoryLibrary {
namespace events {
class DeliveredCarConveyor;
}
}
namespace CarFactoryLibrary {
namespace events {
class CheckRack;
}
}
using namespace LegoCarFactoryRefactoringForSync::__Architecture__Delegatee::Back;

// End of Include stereotype (header)

namespace CarFactoryLibrary {
class IModule;
}
namespace CarFactoryLibrary {
namespace CommunicationInterfaces {
class IRoboticArmFloatMotor;
}
}
namespace CarFactoryLibrary {
namespace events {
class EndOfModule;
}
}
namespace CarFactoryLibrary {
namespace events {
class ErrorDetection;
}
}
namespace EV3PapyrusLibrary {
namespace Interfaces {
namespace Actuators {
class ILargeMotor;
}
}
}
namespace EV3PapyrusLibrary {
namespace Interfaces {
namespace EV3Brick {
class ILcd;
}
}
}
namespace LegoCarFactoryRefactoringForSync {
namespace LegoCarComponents {
namespace Modules {
namespace Back {
class BackControlComponent;
}
}
}
}

namespace LegoCarFactoryRefactoringForSync {
namespace __Architecture__Delegatee {
namespace Back {

/************************************************************/
/**
 * 
 */
class BackControlComponent__Delegatee: public IPush<
		CarFactoryLibrary::events::ErrorDetection>,
		public IPush<CarFactoryLibrary::events::EndOfModule>,
		public ::statemachine::EventQueueAllocationConfiguration {
public:
	/**
	 * 
	 */
	typedef struct State_t {
		bool hasDoActivity;
		//2 is configured as the maximum number of orthogonal regions a composite states can have
		unsigned int actives[2];
		//void (BackControlComponent__Delegatee::*entry)();
		//void (BackControlComponent__Delegatee::*exit)();
		//void (BackControlComponent__Delegatee::*doActivity)();
		State_t() {
			hasDoActivity = false;
			//entry = &BackControlComponent__Delegatee::entry_dft;
			//exit = &BackControlComponent__Delegatee::exit_dft;
			//doActivity = &BackControlComponent__Delegatee::doActivity_dft;
			for (int i = 0; i < 2; i++) {

				actives[i] = STATE_MAX;
			}
		}
	} State_t;

	/**
	 * 
	 */
	enum StateIDEnum {
		/**
		 * 
		 */
		INITIALIZATION_ID,
		/**
		 * 
		 */
		PRINCIPALSTATE_ID,
		/**
		 * 
		 */
		EMNERGENCYSTOPSTATE_ID,
		/**
		 * 
		 */
		CHECK_ID,
		/**
		 * 
		 */
		EMERGENCYBUTTONPRESS_ID,
		/**
		 * 
		 */
		MISPLACE_ID,
		/**
		 * 
		 */
		RESTART_ID,
		/**
		 * 
		 */
		SHOWSTOPGUI_ID,
		/**
		 * 
		 */
		CHECKMESSAGE_ID,
		/**
		 * 
		 */
		RESET_ID,
		/**
		 * 
		 */
		PING_ID,
		/**
		 * 
		 */
		GETSTATUS_ID,
		/**
		 * 
		 */
		LOADCAR_ID,
		/**
		 * 
		 */
		DELIVER_ID,
		/**
		 * 
		 */
		REWIND_ID,
		/**
		 * 
		 */
		ASSEMBLE_ID,
		/**
		 * 
		 */
		STATE_MAX
	};
	/**
	 * 
	 */
	typedef void (BackControlComponent__Delegatee::*FptPointer)();

	/**
	 * 
	 */
	typedef void (BackControlComponent__Delegatee::*RegionFunctionPtr_t)(
			char enter_mode);

	/**
	 * 
	 */
	enum EventId_t {
		/**
		 * 
		 */
		TE_50_MS__ID,
		/**
		 * 
		 */
		ERRORDETECTION_ID,
		/**
		 * 
		 */
		ENDOFMODULE_ID,
		/**
		 * 
		 */
		COMPLETIONEVENT_ID
	};
	/**
	 * 
	 */
	::statemachine::SystemStateEnum_t systemState;
	/**
	 * 
	 */
	::LegoCarFactoryRefactoringForSync::__Architecture__Delegatee::Back::BackControlComponent__Delegatee::State_t states[16];
	/**
	 * 
	 */
	::LegoCarFactoryRefactoringForSync::__Architecture__Delegatee::Back::BackControlComponent__Delegatee::StateIDEnum activeStateID;
	/**
	 * 
	 */
	bool dispatchFlag;
	/**
	 * 
	 */
	int choice2_CompletionEvent;
	/**
	 * 
	 */
	int choice1_CompletionEvent;
	/**
	 * 
	 */
	int choice_CompletionEvent;
	/**
	 * 
	 */
	pthread_t threads[STATE_MAX];
	/**
	 * 
	 */
	bool flags[STATE_MAX];
	/**
	 * 
	 */
	pthread_cond_t conds[STATE_MAX];
	/**
	 * 
	 */
	pthread_mutex_t mutexes[STATE_MAX];
	/**
	 * 
	 */
	::statemachine::StructForThread_t threadStructs[STATE_MAX];
	/**
	 * 
	 */
	::LegoCarFactoryRefactoringForSync::__Architecture__Delegatee::Back::BackControlComponent__Delegatee::FptPointer timeEventTable[1];
	/**
	 * 
	 */
	pthread_t timeEventThreads[1];
	/**
	 * 
	 */
	bool timeEventFlags[1];
	/**
	 * 
	 */
	pthread_cond_t timeEventConds[1];
	/**
	 * 
	 */
	pthread_mutex_t timeEventMutexes[1];
	/**
	 * 
	 */
	::statemachine::StructForThread_t timeEventThreadStructs[1];
	/**
	 * 
	 */
	::LegoCarFactoryRefactoringForSync::__Architecture__Delegatee::Back::BackControlComponent__Delegatee::RegionFunctionPtr_t regionTable[2];
	/**
	 * 
	 */
	::LegoCarFactoryRefactoringForSync::__Architecture__Delegatee::Back::BackControlComponent__Delegatee::FptPointer regionExitTable[2];
	/**
	 * 
	 */
	pthread_t dispatchThread;
	/**
	 * 
	 */
	::statemachine::StructForThread_t dispatchStruct;
	/**
	 * 
	 */
	pthread_mutex_t runToCompletionMutex;
	/**
	 * 
	 */
	pthread_cond_t runToCompletionCond;
	/**
	 * 
	 */
	void dispatchEvent();
	/**
	 * 
	 * @param enter_mode 
	 */
	void BackControlStateMachine_Region1_Enter(char /*in*/enter_mode);
	/**
	 * 
	 * @param enter_mode 
	 */
	void PrincipalState_Region1_Enter(char /*in*/enter_mode);
	/**
	 * 
	 */
	void PrincipalState_Region1_Exit();
	/**
	 * 
	 * @param enter_mode 
	 */
	void EmnergencyStopState_Region1_Enter(char /*in*/enter_mode);
	/**
	 * 
	 */
	void EmnergencyStopState_Region1_Exit();
	/**
	 * 
	 * @param enter_mode 
	 */
	void PrincipalState_Region2_Enter(char /*in*/enter_mode);
	/**
	 * 
	 */
	void PrincipalState_Region2_Exit();
	/**
	 * 
	 */
	BackControlComponent__Delegatee();
	/**
	 * 
	 */
	void startBehavior();
	/**
	 * 
	 */
	~BackControlComponent__Delegatee();
	/**
	 * 
	 */
	void stopBehavior();
	/**
	 * 
	 * @param sig 
	 */
	void processErrorDetection(
			::CarFactoryLibrary::events::ErrorDetection& /*in*/sig);
	/**
	 * 
	 * @param sig 
	 */
	void push(::CarFactoryLibrary::events::ErrorDetection& /*in*/sig);
	/**
	 * 
	 * @param sig 
	 */
	void processEndOfModule(
			::CarFactoryLibrary::events::EndOfModule& /*in*/sig);
	/**
	 * 
	 * @param sig 
	 */
	void push(::CarFactoryLibrary::events::EndOfModule& /*in*/sig);
	/**
	 * 
	 */
	void processTE_50_ms_();
	/**
	 * 
	 */
	void processCompletionEvent();
	/**
	 * 
	 * @param id 
	 */
	void StateEntry(unsigned int /*in*/id);
	/**
	 * 
	 * @param id 
	 */
	void StateExit(unsigned int /*in*/id);
	/**
	 * 
	 * @param id 
	 */
	void StateDoActivity(unsigned int /*in*/id);
	/**
	 * 
	 * @param data 
	 * @return ret 
	 */
	static void* thread_func_wrapper(void* /*in*/data);
	/**
	 * 
	 * @param id 
	 */
	void doCallActivity(int /*in*/id);
	/**
	 * 
	 * @param id 
	 * @param func_type 
	 * @param value 
	 */
	void setFlag(int /*in*/id, char /*in*/func_type, bool /*in*/value);
	/**
	 * 
	 * @param id 
	 * @param duration 
	 */
	void listenTimeEvent(int /*in*/id, int /*in*/duration);
	/**
	 * 
	 * @param id 
	 * @param enter_mode 
	 */
	void regionCall(int /*in*/id, char /*in*/enter_mode);
	/**
	 * 
	 * @param id 
	 */
	void exitRegionCall(int /*in*/id);
	/**
	 * 
	 * @param comp 
	 */
	void setComponent(
			::LegoCarFactoryRefactoringForSync::LegoCarComponents::Modules::Back::BackControlComponent* /*in*/comp);
	/**
	 * 
	 * @return ret 
	 */
	virtual IPush<CarFactoryLibrary::events::ErrorDetection>* get_pErrDetect();
	/**
	 * 
	 * @return ret 
	 */
	virtual IPush<CarFactoryLibrary::events::EndOfModule>* get_pEndOfMo();
	/**
	 * 
	 * @return ret 
	 */
	virtual ::EV3PapyrusLibrary::Interfaces::EV3Brick::ILcd* get_pLCD();
	/**
	 * 
	 * @return ret 
	 */
	virtual ::CarFactoryLibrary::IModule* get_pModule();
	/**
	 * 
	 * @param ref 
	 */
	virtual void connect_pOutStopProcess_Shelf(
			IPush<LegoCarFactoryRefactoringForSync::signals::StopProcess>* /*in*/ref);
	/**
	 * 
	 * @param ref 
	 */
	virtual void connect_pOutStopProcess_RoboticArm(
			IPush<LegoCarFactoryRefactoringForSync::signals::StopProcess>* /*in*/ref);
	/**
	 * 
	 * @param ref 
	 */
	virtual void connect_pStopProcess_Convoyer(
			IPush<LegoCarFactoryRefactoringForSync::signals::StopProcess>* /*in*/ref);
	/**
	 * 
	 * @param ref 
	 */
	virtual void connect_pOutRestart_Shelf(
			IPush<
					LegoCarFactoryRefactoringForSync::signals::RestartAfterEmergencyStop>* /*in*/ref);
	/**
	 * 
	 * @param ref 
	 */
	virtual void connect_pOutRestart_Convoyer(
			IPush<
					LegoCarFactoryRefactoringForSync::signals::RestartAfterEmergencyStop>* /*in*/ref);
	/**
	 * 
	 * @param ref 
	 */
	virtual void connect_pOutRestart_Robotic(
			IPush<
					LegoCarFactoryRefactoringForSync::signals::RestartAfterEmergencyStop>* /*in*/ref);
	/**
	 * 
	 * @param ref 
	 */
	virtual void connect_pPrepare(
			IPush<LegoCarFactoryRefactoringForSync::signals::PrepareConveyor>* /*in*/ref);
	/**
	 * 
	 * @param ref 
	 */
	void connect_pFloatMotor(
			::CarFactoryLibrary::CommunicationInterfaces::IRoboticArmFloatMotor* /*in*/ref);
	/**
	 * 
	 * @param ref 
	 */
	void connect_pLargeMotorConvoyer(
			::EV3PapyrusLibrary::Interfaces::Actuators::ILargeMotor* /*in*/ref);
	/**
	 * 
	 * @param ref 
	 */
	void connect_pLargeMotorPress(
			::EV3PapyrusLibrary::Interfaces::Actuators::ILargeMotor* /*in*/ref);
	/**
	 * 
	 * @param ref 
	 */
	virtual void connect_pOutStopProcess_Press(
			IPush<LegoCarFactoryRefactoringForSync::signals::StopProcess>* /*in*/ref);
	/**
	 * 
	 * @param ref 
	 */
	virtual void connect_pOutRestart_Press(
			IPush<
					LegoCarFactoryRefactoringForSync::signals::RestartAfterEmergencyStop>* /*in*/ref);
	/**
	 * 
	 * @param ref 
	 */
	virtual void connect_pOutDelivered(
			IPush<CarFactoryLibrary::events::DeliveredCarConveyor>* /*in*/ref);
	/**
	 * 
	 * @param ref 
	 */
	virtual void connect_pOutCheckRack(
			IPush<CarFactoryLibrary::events::CheckRack>* /*in*/ref);

private:
	/**
	 * 
	 */
	::LegoCarFactoryRefactoringForSync::LegoCarComponents::Modules::Back::BackControlComponent* component;
};
/************************************************************/
/* External declarations (package visibility)               */
/************************************************************/

/* Inline functions                                         */

} // of namespace Back
} // of namespace __Architecture__Delegatee
} // of namespace LegoCarFactoryRefactoringForSync

/************************************************************
 End of BackControlComponent__Delegatee class header
 ************************************************************/

#endif
